"use strict";(self["webpackChunktry"]=self["webpackChunktry"]||[]).push([[373],{635:function(e,t,o){o(4114);var l=o(4373),a=o(3948),n=o(6874);const r=l.A.create({baseURL:"http://202.195.187.9:8000"});r.interceptors.request.use((e=>{const t=localStorage.getItem("token");if(t){if((0,a.D)(t))return localStorage.removeItem("token"),n.A.push("/login"),Promise.reject(new Error("Token expired"));e.headers.Authorization=`Bearer ${t}`}return e}),(e=>Promise.reject(e))),r.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(localStorage.removeItem("token"),n.A.push("/login")),Promise.reject(e)))),t.A=r},1604:function(e,t,o){o.d(t,{A:function(){return p}});var l=o(6768),a=o(4232);const n={class:"directory-tree"};function r(e,t,o,r,s,c){const d=(0,l.g2)("el-pagination"),i=(0,l.g2)("el-tree"),u=(0,l.g2)("el-scrollbar");return(0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(i,{ref:"tree",data:r.treeData,props:r.defaultProps,load:r.loadNode,lazy:"","node-key":"path","show-checkbox":"",onCheckChange:r.handleCheckChange,onNodeClick:r.handleNodeClick},{default:(0,l.k6)((({node:t,data:o})=>[(0,l.Lk)("span",null,[(0,l.Lk)("i",{class:(0,a.C4)("directory"===o.type?"el-icon-folder":"el-icon-document")},null,2),(0,l.eW)(" "+(0,a.v_)(t.label),1)]),"directory"===o.type&&o.total>10?((0,l.uX)(),(0,l.Wv)(d,{key:0,small:"",layout:"prev, pager, next",total:o.total,"page-size":10,"current-page":o.page,onCurrentChange:o=>e.handlePageChange(t,o)},null,8,["total","current-page","onCurrentChange"])):(0,l.Q3)("",!0)])),_:1},8,["data","props","load","onCheckChange","onNodeClick"])])),_:1})])}o(8111),o(2489),o(1701);var s=o(144),c=o(635),d={name:"filecheck",emits:["selected-files","selected-paths"],setup(e,{emit:t}){const o=(0,s.KR)([]),a=(0,s.KR)(null),n=(0,s.KR)({label:"name",isLeaf:e=>"file"===e.type}),r=localStorage.getItem("token"),d={Authorization:`Bearer ${r}`};(0,l.sV)((async()=>{try{const e=await i();o.value=[{label:"Root",path:"",children:e.data.children||[]}]}catch(e){console.error("Error loading root node:",e)}}));const i=async()=>{0===node.level||node.data.path;const e=await c.A.get("http://202.195.187.9:8000/api/list-directory/",{headers:d});return e},u=async(e,t)=>{try{let o;const l=0===e.level?"":e.data.path;o=await c.A.get("http://202.195.187.9:8000/api/list-directory/",{headers:d,params:{path:l}}),t(o.data.children||[])}catch(o){console.error("Error loading node:",o),t([])}},p=e=>{console.log("Clicked node:",e)},h=()=>{if(a.value){const e=a.value.getCheckedNodes(),o=e.filter((e=>"file"===e.type)).map((e=>e.name)),l=e.filter((e=>"file"===e.type)).map((e=>e.path));t("selected-paths",l),t("selected-files",o)}};return{treeData:o,defaultProps:n,loadNode:u,handleNodeClick:p,handleCheckChange:h,tree:a}}},i=o(1241);const u=(0,i.A)(d,[["render",r],["__scopeId","data-v-f66dd0f0"]]);var p=u},5373:function(e,t,o){o.r(t),o.d(t,{default:function(){return F}});var l=o(6768);const a={class:"container"},n={class:"upload"},r={class:"check"};function s(e,t,o,s,c,d){const i=(0,l.g2)("bar"),u=(0,l.g2)("FileUpload"),p=(0,l.g2)("FlieCheck"),h=(0,l.g2)("el-button");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(i),(0,l.Lk)("div",a,[(0,l.Lk)("div",n,[t[0]||(t[0]=(0,l.Lk)("h3",null,"上传文件",-1)),(0,l.bF)(u)]),(0,l.Lk)("div",r,[t[2]||(t[2]=(0,l.Lk)("h3",null,"选择文件/文件夹",-1)),(0,l.bF)(p,{class:"select",onSelectedPaths:s.handleSelectedPaths},null,8,["onSelectedPaths"]),(0,l.bF)(h,{class:"custom-download-button",onClick:s.handleDownload},{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.Lk)("i",{class:"el-icon-download"},null,-1),(0,l.eW)(" 下载选中文件 ")]))),_:1},8,["onClick"])])])],64)}o(4114),o(4603),o(7566),o(8721);const c={class:"upload-container"};function d(e,t,o,a,n,r){const s=(0,l.g2)("upload-filled"),d=(0,l.g2)("el-icon"),i=(0,l.g2)("el-upload"),u=(0,l.g2)("el-button");return(0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(i,{ref:"uploadRef",class:"upload-demo",drag:"",action:"http://202.195.187.9:8000/api/upload/",multiple:"",headers:a.headers,"on-preview":a.handlePreview,"on-remove":a.handleRemove,"before-upload":a.beforeUpload,"file-list":a.fileList,"auto-upload":!1},{default:(0,l.k6)((()=>[(0,l.bF)(d,{class:"icon"},{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1}),t[0]||(t[0]=(0,l.Lk)("div",null,[(0,l.eW)(" 拖动或 "),(0,l.Lk)("em",null,"点击上传")],-1))])),_:1},8,["headers","on-preview","on-remove","before-upload","file-list"]),(0,l.bF)(u,{class:"submitbutton",type:"primary",onClick:a.submitUpload},{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.eW)("上传文件")]))),_:1},8,["onClick"])])}var i=o(144),u=o(7477),p=o(1219),h={name:"fileupload",components:{UploadFilled:u.m8m},setup(){const e=(0,i.KR)([]),t=localStorage.getItem("token"),o=(0,i.KR)({Authorization:`Bearer ${t}`}),l=(e,t)=>{console.log(e,t)},a=e=>{console.log(e)},n=e=>{const t=e.size/1073741824<10;return!!t||(p.nk.error("大小不能超过10GB!"),!1)},r=(0,i.KR)(null),s=()=>{r.value&&r.value.submit()};return{fileList:e,handleRemove:l,handlePreview:a,beforeUpload:n,headers:o,submitUpload:s,uploadRef:r}}},g=o(1241);const f=(0,g.A)(h,[["render",d],["__scopeId","data-v-7da8ebc5"]]);var k=f,m=o(1604),v=o(7946),b=o(1387),C=o(3948),y=o(635),w={name:"user",components:{bar:v.A,FlieCheck:m.A,FileUpload:k},setup(){const e=(0,i.KR)([]),t=(0,b.rd)(),o=localStorage.getItem("token");console.log("Token:",o),(0,l.KC)((()=>{(0,C.D)(o)&&(localStorage.removeItem("token"),console.log("Redirecting to login"),t.push("/login"))}));const a=t=>{e.value=t,console.log(t)},n=async()=>{if(0!==e.value.length)try{const t=localStorage.getItem("token"),o={Authorization:`Bearer ${t}`},l=await y.A.post("http://202.195.187.9:8000/api/download-file/",{file_paths:e.value},{headers:o,responseType:"blob"}),a=window.URL.createObjectURL(new Blob([l.data])),n=document.createElement("a");n.href=a,n.setAttribute("download","files.zip"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch(t){console.error("Error downloading files:",t),alert("文件下载失败")}else alert("请选择至少一个文件进行下载")};return{handleSelectedPaths:a,handleDownload:n}}};const A=(0,g.A)(w,[["render",s]]);var F=A}}]);
//# sourceMappingURL=373.e29945ec.js.map